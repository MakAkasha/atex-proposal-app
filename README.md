# ATEX Proposal Generator (مولد عروض ATEX)

نظام متكامل لإنشاء وإدارة عروض الأسعار لأنظمة المنازل والمباني الذكية.

## المحتويات

1. [نظرة عامة](#نظرة-عامة)
2. [الميزات الحالية](#الميزات-الحالية)
3. [خطة التنفيذ](#خطة-التنفيذ)
4. [هيكل المشروع](#هيكل-المشروع)
5. [التثبيت والبدء](#التثبيت-والبدء)
6. [المستخدم الافتراضي](#المستخدم-الافتراضي)
7. [API](#api)
8. [التصدير والاستيراد](#التصدير-والاستيراد)

---

## نظرة عامة

ATEX Proposal Generator هو نظام ويب متكامل لإنشاء وإدارة عروض الأسعار بشكل احترافي. تم تطويره خصيصاً لأنظمة التحكم الذكي للمنازل والمباني، ويتميز بدعم كامل للغة العربية وواجهة مستخدم عصرية.

---

## الميزات الحالية

### ✅ الميزات الأساسية
- إنشاء عروض أسعار احترافية
- إدارة المنتجات والعملاء
- لوحة تحكم متكاملة
- دعم العربية بالكامل (RTL)
- تخزين البيانات محلياً (SQLite)
- نظام مصادقة وآمان

### ✅ الميزات التقنية
- REST API كامل
- رفع صور المنتجات
- استيراد من Google Sheets
- معاينات فورية
- طباعة وتصدير PDF

---

## خطة التنفيذ

### المرحلة 1: تحسينات PDF والتصدير (الأولوية العالية)

#### 1.1 نظام قوالب PDF محسن
**الوصف:** إضافة نظام قوالب PDF كامل مع تصميمات متعددة واحترافية

**المخرجات المتوقعة:**
- قالب Professional (افتراضي) - تصميم A4 احترافي كامل
- قالب Compact - صفحة واحدة مختصر
- قالب Invoice - تصميم فواتير
- قالب Detailed - عرض مفصل بالمواصفات

**الخطوات:**
```
1. إنشاء مجلد templates/
2. تطوير قالب professional.html مع:
   - رأس مخصص مع شعار الشركة
   - جدول منتجات متجاوب
   - ملخص الضريبة والخصم
   - تذييل الصفحة
3. تطوير قالب compact.html
4. تطوير قالب invoice.html
5. تطوير قالب detailed.html
6. تحديث server.js لدعم القوالب
7. تحديث واجهة الاختيار في index.html
```

#### 1.2 تحسين جودة PDF
**الوصف:** تحسين جودة ملف PDF عند التصدير

**الخطوات:**
```
1. إضافة مكتبات HTML to PDF
2. تحسين CSS للطباعة
3. إضافة إعدادات جودة PDF
4. دعم_page breaks
```

### المرحلة 2: ميزات العروض (الأولوية العالية)

#### 2.1 نسخ العروض
**الوصف:** إضافة ميزة نسخ عرض موجود لإنشاء عرض جديد بسرعة

**المخرجات:**
- زر "نسخ" في قائمة العروض
- نسخ جميع البيانات والصور
- إنشاء رقم عرض جديد تلقائياً

**الخطوات:**
```
1. إضافة زر النسخ في واجهة العروض
2. إنشاء endpoint: POST /api/proposals/:id/duplicate
3. نسخ بيانات العرض:
   - العنوان مع إضافة "نسخة من"
   - العميل
   - المنتجات والكمية
   - الخصم والضريبة
   - الملاحظات والشروط
4. إنشاء رقم عرض جديد
5. حفظ كعرض جديد
```

### المرحلة 3: استيراد وتصدير البيانات (الأولوية المتوسطة)

#### 3.1 تحسين استيراد Google Sheets
**الوصف:** تحسين نظام استيراد المنتجات من Google Sheets

**المخرجات:**
- معاينة مباشرة للبيانات قبل الاستيراد
- اختيار الأعمدة يدوياً
- خريطة تلقائية للأعمدة
- معالجة الأخطاء والتحقق

**الخطوات:**
```
1. تحسين واجهة اختيار الأعمدة
2. إضافة معاينة 5 صفوف قبل الاستيراد
3. التحقق من صحة البيانات:
   - SKU فريد
   - أرقام صالحة للسعر
4. إضافة خيار "تجاهل الصفوف الفارغة"
5. إضافة خيار "استبدال المنتجات الموجودة"
6. تحسين رسائل الخطأ
```

#### 3.2 تصدير البيانات
**الوصف:** إضافة إمكانية تصدير البيانات لملفات Excel/CSV

**المخرجات:**
- تصدير العروض لملف Excel
- تصدير العملاء لملف CSV
- تصدير المنتجات لملف Excel
- خيارات تحديد التاريخ والنطاق

**الخطوات:**
```
1. إضافة مكتبات Excel/CSV
2. إنشاء endpoint: GET /api/export/proposals
3. إنشاء endpoint: GET /api/export/customers
4. إنشاء endpoint: GET /api/export/products
5. إضافة أزرار التصدير في الواجهة
6. تصميم واجهة اختيار الفلاتر
```

### المرحلة 4: التقارير والتحليلات (الأولوية المتوسطة)

#### 4.1 تقارير المبيعات
**الوصف:** إضافة تقارير مبيعات شاملة

**المخرجات:**
- تقرير المبيعات الشهري
- تقرير العروض حسب الحالة
- مقارنة الفترات
- رسوم بيانية

**الخطوات:**
```
1. إنشاء صفحة التقارير
2. إضافة فلترات التاريخ
3. إضافة رسوم بيانية:
   - مخطط خطي للمبيعات
   - مخطط دائري للحالات
   - جدول ملخص
4. حساب الإحصائيات:
   - إجمالي المبيعات
   - عدد العروض
   - معدل القبول
   - متوسط قيمة العرض
```

#### 4.2 تحليل أداء المنتجات
**الوصف:** تحليل أداء المنتجات في العروض

**المخرجات:**
- المنتجات الأكثر مبيعاً
- الإيرادات حسب الفئة
- تحليل حركة المخزون

**الخطوات:**
```
1. إنشاء endpoint: GET /api/analytics/products
2. حساب:
   - عدد مرات الظهور في العروض
   - الكمية المباعة
   - الإيرادات
3. إضافة صفحة تحليلات المنتجات
4. عرض أفضل 10 منتجات
5. عرض المنتجات حسب الفئة
```

### المرحلة 5: تحسين تجربة المستخدم (الأولوية العادية)

#### 5.1 تحسين التوافق مع الجوال
**الوصف:** تحسين واجهة الجوال للتابلت والهواتف

**المخرجات:**
- تصميم متجاوب بالكامل
- تحسين قائمة المنتجات
- تحسين جداول البيانات
- تحسين أزرار الإجراءات

**الخطوات:**
```
1. مراجعة CSS للجوال
2. تحسين:
   - شبكة المنتجات (2 أعمدة)
   - جدول العروض (scroll أفقي)
   - قائمة الإجراءات
   - النماذج
3. اختبار على أجهزة مختلفة
```

#### 5.2 بحث متقدم للمنتجات
**الوصف:** إضافة بحث متقدم مع دعم الباركود

**المخرجات:**
- بحث فوري أثناء الكتابة
- دعم مسح الباركود
- نتائج مباشرة
- اختصارات لوحة المفاتيح

**الخطوات:**
```
1. تحسين JavaScript للبحث
2. إضافة debounce للبحث
3. إضافة دعم scanner API
4. إضافة اختصارات:
   - Ctrl+F للبحث
   - Ctrl+N لمنتج جديد
   - Ctrl+S للحفظ
```

---

## هيكل المشروع

```
Q/
├── server.js              # الخادم الرئيسي
├── package.json           # تبعيات npm
├── README.md              # هذه الوثائق
├── atex.db                # قاعدة البيانات SQLite
├── product-image/         # صور المنتجات
│   ├── AR-G1.png
│   ├── DR-02.png
│   └── ...
└── public/                # ملفات الواجهة
    ├── index.html         # التطبيق الرئيسي
    ├── ATEX-logo.svg      # شعار الشركة
    ├── ATEX Slogan.svg    # شعار الشركة
    └── sar_symbol.svg     # رمز الريال
```

---

## التثبيت والبدء

### المتطلبات
- Node.js 18+
- npm أو pnpm

### التثبيت

```bash
# تثبيت التبعيات
npm install

# تشغيل الخادم
npm start
```

### الوصول
- **الواجهة:** http://localhost:8080
- **API:** http://localhost:8080/api

---

## المستخدم الافتراضي

عند أول تشغيل، يتم إنشاء مستخدم افتراضي:

```
اسم المستخدم: admin
كلمة المرور: admin123
```

**ملاحظة:** يُنصح بتغيير كلمة المرور فور الدخول من صفحة الإعدادات.

---

## API

### المصادقة

```bash
POST /api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}
```

### المنتجات

```bash
# قائمة المنتجات
GET /api/products

# إضافة منتج
POST /api/products
{
  "sku": "FT-300",
  "name": "جهاز تحكم ذكي",
  "price": 450,
  "category": "FT"
}
```

### العملاء

```bash
# قائمة العملاء
GET /api/customers

# إضافة عميل
POST /api/customers
{
  "name": "اسم العميل",
  "company": "اسم الشركة",
  "email": "email@company.com",
  "phone": "05xxxxxxxx"
}
```

### العروض

```bash
# قائمة العروض
GET /api/proposals

# إنشاء عرض
POST /api/proposals
{
  "title": "عرض سعر Villa 123",
  "customer_id": 1,
  "items": [
    {
      "product_id": 1,
      "quantity": 2,
      "unit_price": 450
    }
  ],
  "discount_percent": 10,
  "tax_percent": 15
}

# نسخ عرض
POST /api/proposals/:id/duplicate

# تحديث الحالة
PUT /api/proposals/:id/status
{
  "status": "accepted"
}
```

---

## النشر على الخادم (VPS)

### النشر السريع مع PM2

```bash
# الاتصال بالخادم
ssh username@vps-ip

# تثبيت Node.js
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# تثبيت PM2
sudo npm install -g pm2

# رفع الملفات (SCP أو Git)
cd atex-app
npm install

# تشغيل التطبيق
pm2 start server.js --name atex-app -- --production

# إعداد التشغيل التلقائي
pm2 startup
pm2 save

# عرض الحالة
pm2 status
```

### استخدام Nginx كـ Reverse Proxy

```bash
sudo apt install nginx

# إنشاء ملف الإعدادات
sudo nano /etc/nginx/sites-available/atex-app
```

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

```bash
sudo ln -s /etc/nginx/sites-available/atex-app /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl restart nginx
```

### أوامر PM2 المفيدة

```bash
pm2 logs atex-app    # عرض السجلات
pm2 restart atex-app # إعادة تشغيل
pm2 stop atex-app    # إيقاف
pm2 monit            # مراقبة الموارد
```

**الملف:** راجع `DEPLOYMENT.md` للمزيد من التفاصيل.

---

## التصدير والاستيراد

### Google Sheets

```bash
# 1. الحصول على رابط الجدول
https://docs.google.com/spreadsheets/d/SPREADSHEET_ID/edit

# 2. إضافة الرابط في الإعدادات
# 3. اختيار الأعمدة
# 4. استيراد المنتجات
```

### تصدير البيانات

```bash
# تصدير العروض
GET /api/export/proposals?format=excel&from=2024-01-01&to=2024-12-31

# تصدير العملاء
GET /api/export/customers?format=csv

# تصدير المنتجات
GET /api/export/products?format=excel
```

---

## حالة التنفيذ

| الميزة | الأولوية | الحالة | التقدم |
|--------|----------|--------|--------|
| نظام قوالب PDF | عالية | لم تبدأ | 0% |
| نسخ العروض | عالية | لم تبدأ | 0% |
| تحسين Google Sheets | متوسطة | لم تبدأ | 0% |
| تصدير البيانات | متوسطة | لم تبدأ | 0% |
| تقارير المبيعات | متوسطة | لم تبدأ | 0% |
| تحليل المنتجات | متوسطة | لم تبدأ | 0% |
| تحسين الجوال | عادية | لم تبدأ | 0% |
| بحث متقدم | عادية | لم تبدأ | 0% |

---

## خارطة الطريق

### الإصدار 2.0
- PDF Templates كامل
- نظام نسخ العروض
- تقارير المبيعات
- تصدير البيانات

### الإصدار 2.1
- تحسينات الجوال
- بحث متقدم
- تحليل المنتجات
- تحسين Sheets

### الإصدار 3.0 (مستقبلي)
- تطبيق جوال
- تكامل دفع
- نظام اشتراكات

---

## الدعم

للدعم والاستفسارات: support@atex.sa

---

## الترخيص

MIT License